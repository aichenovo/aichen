!function(){"use strict";function e(e,t,i,o){return new(i||(i=Promise))(function(n,s){function r(e){try{l(o.next(e))}catch(e){s(e)}}function a(e){try{l(o.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,a)}l((o=o.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const t={show(e,t=3e3,i="info"){this.remove();const o=this.getTypeConfig(i),n=`\n        <div id="custom-toast" style="\n          position: fixed; \n          top: 55%; \n          left: 50%; \n          transform: translate(-50%, -50%); \n          z-index: 10000; \n          pointer-events: none;\n          opacity: 0;\n          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        ">\n          <div class="toast-content" style="\n            background: ${o.background};\n            color: ${o.color};\n            padding: 16px 14px;\n            border-radius: 12px;\n            box-shadow: 0 8px 32px ${o.shadow};\n            border: 1px solid ${o.border};\n            backdrop-filter: blur(16px);\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            max-width: min(230px, 80vw);\n            word-wrap: break-word;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            font-size: 15px;\n            font-weight: 500;\n            line-height: 1.4;\n          ">\n            <div class="toast-icon" style="\n              width: 20px;\n              height: 20px;\n              flex-shrink: 0;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              background: ${o.iconBg};\n              border-radius: 50%;\n              font-size: 12px;\n            ">\n              ${o.icon}\n            </div>\n            <div class="toast-message" style="flex: 1;">\n              ${e}\n            </div>\n          </div>\n        </div>\n      `,s=document.createElement("div");s.innerHTML=n;const r=s.firstElementChild;document.body.appendChild(r),requestAnimationFrame(()=>{r.style.opacity="1",r.style.transform="translate(-50%, -50%)"}),t>0&&setTimeout(()=>{this.hide()},t)},remove(){var e;null===(e=document.getElementById("custom-toast"))||void 0===e||e.remove()},getTypeConfig(e){const t={success:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.9) 0%, rgba(5, 150, 105, 0.9) 100%)",color:"#ffffff",border:"rgba(16, 185, 129, 0.3)",shadow:"rgba(16, 185, 129, 0.25)",iconBg:"rgba(255, 255, 255, 0.2)",icon:"âœ“"},error:{background:"linear-gradient(135deg, rgba(239, 68, 68, 0.9) 0%, rgba(220, 38, 38, 0.9) 100%)",color:"#ffffff",border:"rgba(239, 68, 68, 0.3)",shadow:"rgba(239, 68, 68, 0.25)",iconBg:"rgba(255, 255, 255, 0.2)",icon:"âœ•"},warning:{background:"linear-gradient(135deg, rgba(245, 158, 11, 0.9) 0%, rgba(217, 119, 6, 0.9) 100%)",color:"#ffffff",border:"rgba(245, 158, 11, 0.3)",shadow:"rgba(245, 158, 11, 0.25)",iconBg:"rgba(255, 255, 255, 0.2)",icon:"âš "},info:{background:"linear-gradient(135deg, rgba(59, 130, 246, 0.9) 0%, rgba(37, 99, 235, 0.9) 100%)",color:"#ffffff",border:"rgba(59, 130, 246, 0.3)",shadow:"rgba(59, 130, 246, 0.25)",iconBg:"rgba(255, 255, 255, 0.2)",icon:"â“˜"}};return t[e]||t.info},hide(){const e=document.getElementById("custom-toast");e&&(e.style.opacity="0",e.style.transform="translate(-50%, -60%)",setTimeout(()=>{e.remove()},300))},success(e,t=3e3){this.show(e,t,"success")},error(e,t=3e3){this.show(e,t,"error")},warning(e,t=3e3){this.show(e,t,"warning")},info(e,t=3e3){this.show(e,t,"info")}},i={request(t){return e(this,arguments,void 0,function*(e,t="get",i="json",o="",n,s,r){let a,l,d=e,c={method:t.toUpperCase(),headers:{}};if("get"===t){if(o&&"object"==typeof o){const e=new URLSearchParams(o).toString();d+=(d.includes("?")?"&":"?")+e}}else o instanceof URLSearchParams?(c.headers=new Headers({"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}),c.body=o.toString()):o instanceof FormData?(c.headers=new Headers({"X-Requested-With":"XMLHttpRequest"}),c.body=o):"object"==typeof o?(c.headers=new Headers({"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}),c.body=o.toString()):c.body=o;let h="success";try{if(a=yield fetch(d,c),!a.ok)throw new Error(a.statusText);l="json"===i?yield a.json():yield a.text(),n&&n(l)}catch(e){h="error",s&&s(e,h,null==e?void 0:e.message)}finally{r&&r(l,h)}})},get(e,t,i,o){return this.request(e,"get","json",t,i,o)},post(e,t,i,o){return this.request(e,"post","json",t,i,o)},getHtml(e,t,i,o){return this.request(e,"get","text",t,i,o)},submitForm(e,t,i,o,n){return this.request(e,"post","json",t,i,o,n)}};let o=null,n=null,s=!1;function r(e,t){var o;null===(o=document.getElementById("popup-content"))||void 0===o||o.remove(),function(){var e;return"play"===(null===(e=window.PAGE_INFO)||void 0===e?void 0:e.currentPage)||window.location.pathname.includes("/play/")||null!==document.querySelector(".player-box-main")}()&&a(),i.getHtml(e,{},e=>{const t=document.createElement("div");if(t.innerHTML=e,t.firstElementChild){document.body.appendChild(t.firstElementChild);const e=document.getElementById("video-info-display");if(e){const t=(e.textContent||"").replace(/\s+http.*$/,"");e.textContent=t}}})}function a(){if(!s&&(o=document.querySelector(".player-box-main"),o)){!function(e){try{e.querySelectorAll("video").forEach(e=>{e.paused||e.pause()})}catch(e){}}(o);const e=o.children;for(let t=0;t<e.length;t++){e[t].style.display="none"}"static"===getComputedStyle(o).position&&(o.style.position="relative"),n=document.createElement("div"),n.id="player-mask-overlay",n.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      z-index: 9999;\n      background: rgba(0, 0, 0, 0.8);\n      backdrop-filter: blur(10px);\n      -webkit-backdrop-filter: blur(10px);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n      font-size: 14px;\n      text-align: center;\n      line-height: 1.5;\n    ",n.innerHTML='\n      <div style="padding: 20px;">\n        <div style="margin-bottom: 8px;">ğŸ¬</div>\n        <div>æ’­æ”¾å™¨å·²ä¸´æ—¶éšè—</div>\n        <div style="font-size: 12px; opacity: 0.8; margin-top: 4px;">å…³é—­å¼¹çª—åæ¢å¤</div>\n      </div>\n    ',o.appendChild(n),s=!0}}function l(){if(s){if(o){const e=o.children;for(let t=0;t<e.length;t++){const i=e[t];"player-mask-overlay"!==i.id&&(i.style.display="")}}n&&(n.remove(),n=null),o=null,s=!1}}window.addPlayerMask=a,window.removePlayerMask=l;const d={parseHash(){const e=window.location.hash;if(!e)return null;const t=new URLSearchParams(e.slice(1)),i=t.get("sid"),o=t.get("nid"),n=t.get("t");return i&&o?{sid:i,nid:parseInt(o,10),currentTime:n?parseFloat(n):void 0}:null},setHash(e,t,i){let o=`#sid=${e}&nid=${t}`;if(void 0!==i&&i>0&&(o+=`&t=${i}`),window.EXTERNAL_SEARCH_PARAMS){const e=window.EXTERNAL_SEARCH_PARAMS;e.name&&(o+=`&name=${encodeURIComponent(e.name)}`),e.year&&(o+=`&year=${encodeURIComponent(e.year)}`),e.type&&(o+=`&type=${encodeURIComponent(e.type)}`),e.douban_id&&(o+=`&douban_id=${encodeURIComponent(e.douban_id)}`)}window.location.hash!==o&&history.replaceState(null,"",window.location.pathname+window.location.search+o)},validateState(e,t,i){var o;const n=i.find(t=>t.sid===e);if(!n)return!1;return!!(null===(o=n.urls)||void 0===o?void 0:o.find(e=>e.nid===t))},getDefaultState(e){var t;if(0===e.length)return null;const i=e[0],o=null===(t=i.urls)||void 0===t?void 0:t[0];return o?{sid:i.sid,nid:o.nid}:null}};class c{static getLoadingScreenHTML(e,t){return`\n      \x3c!-- ä¸“ä¸šåŠ è½½å±å¹•è¦†ç›–å±‚ --\x3e\n      <div id="professional-loading-overlay" class="absolute flex flex-col items-center justify-center bg-gradient-to-b from-black via-black to-gray-900 overflow-hidden" style="z-index: 1000; top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%;">\n        \x3c!-- Background Pattern --\x3e\n        <div class="absolute opacity-5" style="top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%;">\n          <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-transparent via-transparent to-gray-800/10"></div>\n        </div>\n        \n        \x3c!-- Main Content --\x3e\n        <div class="relative z-10 flex flex-col items-center justify-center px-4 py-4">\n          \x3c!-- Logo/Brand --\x3e\n          <div class="text-center text-white mb-8">\n            <div class="text-base text-yellow-400 tracking-wider font-semibold opacity-90 md:text-lg">${t||window.location.host}</div>\n            <div id="loading-tip-context" class="mt-2 max-w-[80vw] truncate text-base font-semibold text-white/90 md:text-lg" style="display: none;"></div>\n          </div>\n          \n          \x3c!-- Enhanced Loading Animation --\x3e\n          <div id="loading-spinner" class="relative mb-4">\n            \x3c!-- Outer Ring --\x3e\n            <div class="w-14 h-14 md:w-20 md:h-20 border-4 border-gray-600 rounded-full animate-pulse"></div>\n            \x3c!-- Spinning Ring --\x3e\n            <div class="absolute w-14 h-14 md:w-20 md:h-20 border-4 border-transparent border-t-red-500 border-r-red-400 rounded-full animate-spin" style="top: 0; left: 0; right: 0; bottom: 0;"></div>\n            \x3c!-- Inner Dot --\x3e\n            <div class="absolute flex items-center justify-center" style="top: 0; left: 0; right: 0; bottom: 0; width: 100%; height: 100%;">\n              <div class="w-1.5 h-1.5 md:w-3 md:h-3 bg-red-500 rounded-full animate-ping"></div>\n            </div>\n          </div>\n          \n          \x3c!-- Loading Tips --\x3e\n          <div id="loading-tip-container" class="text-center text-xs text-gray-400 max-w-xs leading-relaxed">\n            <div id="loading-tip-dynamic">æ­£åœ¨åˆå§‹åŒ–æ’­æ”¾å™¨...</div>\n          </div>\n        </div>\n      </div>\n    `}static createLoadingScreen(e,t,i){document.querySelector("#professional-loading-overlay")||(e.insertAdjacentHTML("beforeend",this.getLoadingScreenHTML(t,i)),this.setMode(this.lastMode),this.setContext(this.lastContext),this.lastText&&this.show(this.lastText))}static show(e){this.lastText=e;const t=document.getElementById("loading-tip-dynamic");t&&(t.textContent=e)}static setContext(e){const t=(e||"").trim();this.lastContext=t;const i=document.getElementById("loading-tip-context");if(i){if(!t)return i.textContent="",void(i.style.display="none");i.textContent=t,i.style.display=""}}static setMode(e){this.lastMode=e;const t=document.getElementById("loading-spinner");t&&(t.style.display="manual"===e?"none":"");const i=document.getElementById("loading-tip-container");i&&("manual"===e?(i.style.fontSize="16px",i.style.fontWeight="600",i.style.color="#f8cf03"):(i.style.fontSize="",i.style.fontWeight="",i.style.color=""))}static hideLoadingScreen(e){const t=document.querySelector("#professional-loading-overlay");t?(t.style.opacity="0",t.style.transition="opacity 0.5s ease-out",setTimeout(()=>{t.remove(),null==e||e()},500)):e&&e()}}c.lastText="æ­£åœ¨åˆå§‹åŒ–æ’­æ”¾å™¨...",c.lastContext="",c.lastMode="loading","undefined"!=typeof window&&(window.LoadingScreenComponent=c),window.playlist=function(){var i;return{$dispatch:(e,t)=>{},playlistData:[],currentSourceSid:"",currentEpisodeNid:0,hashResumeTime:null,manualSelection:!1,autoPlayPending:!1,sortDesc:"desc"===localStorage.getItem("episode_sort"),externalLoading:!1,globalLoading:!1,vodName:window.PAGE_INFO.vodName,showSourceTab:!1,isDetailPage:"detail"===(null===(i=window.PAGE_INFO)||void 0===i?void 0:i.currentPage),showSourceGuide:!1,showSourceGuideModal:!1,noSource:!1,init(){this.playlistData=this.simplifyPlaylistData(window.PLAYLIST_DATA);(navigator.userAgent||"").includes("HeyTapBrowser")&&(this.playlistData=this.playlistData.filter(e=>"NBY"!==e.from)),this.fetchExternalSources(),window.playlistComponent=this,0===this.playlistData.length&&(this.globalLoading=!0),this.isDetailPage?this.playlistData.length>0&&(this.currentSourceSid=this.playlistData[0].sid):(this.$watch("currentEpisodeNid",(e,t)=>{if(!this.autoPlayPending)return;if(this.autoPlayPending=!1,e<=0||!this.currentSourceSid)return;const i=this.hashResumeTime,o={sid:this.currentSourceSid,nid:this.currentEpisodeNid};"number"==typeof i&&i>0&&(o.continueTime=i),setTimeout(()=>{this.$dispatch("start-play",o)},200),this.hashResumeTime=null,this.manualSelection=!1}),this.restoreFromHash())},setDefaultPlayState(){const e=d.getDefaultState(this.playlistData);if(e){const t=this.currentSourceSid===e.sid&&this.currentEpisodeNid===e.nid;this.manualSelection=!1,this.currentSourceSid=e.sid,t||(this.autoPlayPending=!0,this.currentEpisodeNid=e.nid),d.setHash(e.sid,e.nid),this.globalLoading=!1,this.hashResumeTime=null}},restoreFromHash(){const e=d.parseHash();if(e)this.manualSelection=!1,this.hashResumeTime="number"==typeof e.currentTime?e.currentTime:null,this.applyHashState(e);else{if(this.hashResumeTime=null,!this.playlistData.length)return;const e=this.playlistData[0];!(!e||!Array.isArray(e.urls)||1!==e.urls.length)?this.setDefaultPlayState():this.setManualSelectionState()}},applyHashState(e){if(d.validateState(e.sid,e.nid,this.playlistData)){const t=this.currentSourceSid===e.sid&&this.currentEpisodeNid===e.nid;this.manualSelection=!1,this.currentSourceSid=e.sid,t||(this.autoPlayPending=!0,this.currentEpisodeNid=e.nid)}else{if(this.externalLoading)return;this.setDefaultPlayState()}this.globalLoading=!1},setManualSelectionState(){this.playlistData.length&&(this.manualSelection=!0,this.autoPlayPending=!1,this.currentSourceSid||(this.currentSourceSid=this.playlistData[0].sid),this.currentEpisodeNid=0,this.globalLoading=!1,c.setContext(""),c.setMode("manual"),c.show("è¯·é€‰æ‹©é›†æ•°å¼€å§‹æ’­æ”¾"))},setCurrentSourceSid(e){this.currentSourceSid=e},setCurrentEpisodeNid(e){this.currentEpisodeNid=e},setGlobalLoading(e){this.globalLoading=e},handleSourceClick(){this.showSourceGuide&&this.playlistData.length>=2&&!this.isDetailPage?(this.showSourceGuideModal=!0,document.body.style.overflow="hidden",window.addPlayerMask()):this.showSourceTab=!this.showSourceTab},selectSource(e){this.currentSourceSid!==e&&(this.currentSourceSid=e,this.showSourceTab=!1,this.currentEpisodeNid>0?(d.setHash(e,this.currentEpisodeNid),this.$dispatch("source-selected",{currentEpisodeNid:this.currentEpisodeNid})):(this.manualSelection=!0,c.setContext(""),c.setMode("manual"),c.show("è¯·é€‰æ‹©é›†æ•°å¼€å§‹æ’­æ”¾")))},selectEpisode(e){var t;if(this.currentEpisodeNid===e)return;this.currentEpisodeNid=e,this.manualSelection=!1;const i=(null===(t=this.currentSource)||void 0===t?void 0:t.sid)||this.currentSourceSid;d.setHash(i,e),this.hashResumeTime=null,this.$dispatch("start-play",{sid:i,nid:e})},handlePrevEpisode(){this.currentEpisodeNid<=1||this.selectEpisode(this.currentEpisodeNid-1)},handleNextEpisode(){this.currentEpisodeNid>=this.currentEpisodes.length||this.selectEpisode(this.currentEpisodeNid+1)},toggleSort(){this.sortDesc=!this.sortDesc,localStorage.setItem("episode_sort",this.sortDesc?"desc":"asc")},get currentSource(){return this.playlistData.find(e=>e.sid==this.currentSourceSid)},get currentEpisodes(){if(!this.currentSource)return[];const e=this.currentSource.urls||[];return this.sortDesc?[...e].reverse():e},get shouldShowContent(){return!(!this.isDetailPage&&!this.currentSourceSid)},get isLoading(){return this.globalLoading||this.externalLoading},processExternalItem(e){const t=this.parsePlayUrls(e.vod_play_url);return{sort:e.sort,show:e.site_name,sid:e.site_key,from:e.vod_play_from,urls:t.map((t,i)=>({sid:e.site_key,nid:i+1,part:t.name,url:t.url,vodFrom:e.vod_play_from}))}},parsePlayUrls(e){const t=[];if(!e)return t;return e.split("#").forEach(e=>{if(!e)return;const i=e.split("$");t.push({name:i[0],url:i[1]})}),t},fetchExternalSources(){return e(this,void 0,void 0,function*(){this.externalLoading=!0;try{const e=window.EXTERNAL_SEARCH_PARAMS&&(!window.PAGE_INFO.vodId||"0"==window.PAGE_INFO.vodId);let t="/api.php/internal/search_aggregate",i=new URLSearchParams;e?(i.set("name",window.EXTERNAL_SEARCH_PARAMS.name),window.EXTERNAL_SEARCH_PARAMS.year&&i.set("year",window.EXTERNAL_SEARCH_PARAMS.year),window.EXTERNAL_SEARCH_PARAMS.type&&i.set("type",window.EXTERNAL_SEARCH_PARAMS.type),window.EXTERNAL_SEARCH_PARAMS.douban_id&&i.set("douban_id",window.EXTERNAL_SEARCH_PARAMS.douban_id)):i.set("vod_id",window.PAGE_INFO.vodId);const o=yield fetch(`${t}?${i}`),{code:n,data:s}=yield o.json();let r=[];if(200===n&&Array.isArray(s)){r=s.map(e=>this.processExternalItem(e)),r.sort((e,t)=>e.sort-t.sort);const e=[...r,...this.playlistData].sort((e,t)=>e.sort-t.sort);this.playlistData=e}}catch(e){}finally{if(this.externalLoading=!1,this.globalLoading=!1,0===this.playlistData.length){this.noSource=!0;const e=document.querySelector(".player-box-main");return void(e&&(e.style.display="none"))}this.isDetailPage?this.currentSourceSid=this.playlistData[0].sid:this.restoreFromHash(),this.checkFirstVisit()}})},simplifyPlaylistData(e){if(!e||"object"!=typeof e)return[];const t=window.matchMedia("(max-width: 768px)").matches||window.matchMedia("(pointer: coarse)").matches;let i=Object.values(e).map(e=>({sort:e.player_info.sort||100,show:e.player_info.show,sid:e.player_info.from,from:e.player_info.from,decodeStatus:e.player_info.decode_status||"0",urls:Object.values(e.urls).map(t=>({sid:e.player_info.from,nid:t.nid,part:t.name,url:t.url,vodFrom:e.from}))}));return t&&(i=i.filter(e=>"JL2K"!==e.show&&"JL4K"!==e.show)),i.sort((e,t)=>e.sort-t.sort)},report(){var e;const t=this.currentEpisodes.find(e=>e.nid===this.currentEpisodeNid),i=t?` ${t.part}`:"",o=`${null===(e=this.currentSource)||void 0===e?void 0:e.show}çº¿è·¯-ã€Š${this.vodName}ã€‹${i} ${location.href}`;r("/gbook/report.html?name="+encodeURIComponent(o))},share(){const e=`${location.href} æˆ‘æ­£åœ¨${window.PAGE_INFO.siteName}è§‚çœ‹ã€Š${window.PAGE_INFO.vodName}ã€‹,æ¨èç»™ä½ ä¸€èµ·çœ‹ï¼`;this.copyToClipboard(e)},copyToClipboard(e){const i=document.createElement("textarea");i.value=e,i.style.cssText="position: fixed; transform: translateX(-9999px)",document.body.appendChild(i),i.focus(),i.select();try{document.execCommand("copy"),t.success("å¤åˆ¶æˆåŠŸï¼Œå¿«å»åˆ†äº«å§ï½")}catch(e){t.error("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ç½‘å€")}finally{document.body.removeChild(i)}},checkFirstVisit(){!localStorage.getItem("source_guide_shown")&&this.playlistData.length>=2&&(this.showSourceGuide=!0)},closeSourceGuide(){this.showSourceGuideModal=!1,this.showSourceGuide=!1,document.body.style.overflow="",window.removePlayerMask(),localStorage.setItem("source_guide_shown","true")}}},window.historyPanel=function(){return{isVisible:!1,historyList:[],config:{key:"play_history",maxItems:10},init(){this.loadHistory()},togglePanel(){this.isVisible=!this.isVisible,this.isVisible&&this.loadHistory()},loadHistory(){const e=JSON.parse(localStorage.getItem(this.config.key)||"{}");this.historyList=Object.entries(e).map(([e,t])=>Object.assign(Object.assign({},t),{historyKey:e})).sort((e,t)=>t.createTime-e.createTime)},clickHistory(e){const t=JSON.parse(localStorage.getItem(this.config.key)||"{}")[e];if(t)if(t.playUrl){const e=new URL(t.playUrl,window.location.origin),i=new URLSearchParams(e.hash.slice(1));i.set("t",t.currentTime.toString()),window.location.href=e.pathname+"#"+i.toString()}else{const e=`/vb/${t.vodId}.html#sid=${t.vodSid}&nid=${t.vodNid}&t=${t.currentTime}`;window.location.href=e}},clearHistory(){localStorage.removeItem(this.config.key),this.historyList=[]},handleOutsideClick(e){this.$el.contains(e.target)||(e.preventDefault(),e.stopPropagation(),this.isVisible=!1)}}},window.searchHistory=function(){return{key:"search_history",max:10,historyList:[],controller:null,init(){this.loadHistory(),this.controller&&this.controller.abort(),this.controller=new AbortController,document.addEventListener("add-history",e=>{this.addHistory(e.detail)},{signal:this.controller.signal})},destroy(){this.controller&&(this.controller.abort(),this.controller=null)},loadHistory(){this.historyList=JSON.parse(localStorage.getItem(this.key)||"[]")},clearHistory(){localStorage.setItem(this.key,"[]"),this.loadHistory()},removeHistory(e){this.historyList=this.historyList.filter(t=>t!==e),localStorage.setItem(this.key,JSON.stringify(this.historyList))},addHistory(e){if(!e)return;let t=this.historyList.filter(t=>t!==e);t.unshift(e),t.length>this.max&&(t=t.slice(0,this.max)),this.historyList=t,localStorage.setItem(this.key,JSON.stringify(t))}}},window.searchBox=function(){return{keyword:"",isOpen:!1,showLoading:!1,searchResultsVisible:!1,searchHtml:"",hotPlaceholder:"",isMobile:window.innerWidth<640,autocompleteSuggestions:[],debounceTimer:null,lastSearchKeyword:"",suggestionCache:new Map,selectedIndex:-1,init(){this.loadHotPlaceholder(),this.resizeBound||(window.addEventListener("resize",()=>{this.isMobile=window.innerWidth<640}),this.resizeBound=!0),window.searchKeyword&&(this.keyword=window.searchKeyword),this.popstateBound||(window.addEventListener("popstate",()=>{this.searchResultsVisible&&this.closeSearch()}),this.popstateBound=!0),this.historySearchBound||(this.$el.addEventListener("history-search",e=>{this.handleHistoryClick(e.detail)}),this.historySearchBound=!0)},get isMobileOpen(){return this.isOpen&&this.isMobile},handleOutsideClick(e){var t;(null===(t=e.target)||void 0===t?void 0:t.closest("input"))||(this.isOpen=!1,this.clearAutocomplete())},destroy(){this.clearAutocomplete()},loadHotPlaceholder(){const e=document.querySelector("#hot-placeholder-data");e&&e.textContent?this.hotPlaceholder=e.textContent.trim():this.hotPlaceholder="æœç´¢å½±ç‰‡åç§°"},showFullScreenLoading(){this.showLoading=!0,this.isOpen=!1},hideFullScreenLoading(){this.showLoading=!1},closeSearch(){this.searchResultsVisible=!1,this.searchHtml="",this.keyword=""},handleSearchInputClick(){this.searchResultsVisible&&(this.searchResultsVisible=!1,this.searchHtml="",this.keyword=""),this.isOpen=!0},handleCancel(){this.keyword="",this.isOpen=!1,this.clearAutocomplete()},performSearch(i){return e(this,arguments,void 0,function*(e,i=!1){var o;try{let n;if(!e){const e=document.querySelector("#rank-list .rank-item:first-child a");return void(window.location.href=e.href)}{const t=i?"?direct=1":"";n=`/vodsearch/${encodeURIComponent(e)}--.html${t}`}if("play"===(null===(o=window.PAGE_INFO)||void 0===o?void 0:o.currentPage))return void(window.location.href=n);this.showFullScreenLoading();const s=yield fetch(n);s.ok||t.error("æœç´¢è¯·æ±‚å¤±è´¥");const r=yield s.text(),a=new DOMParser,l=a.parseFromString(r,"text/html").body.innerHTML;this.searchHtml=l,this.searchResultsVisible=!0;const d=document.querySelector('header input[type="text"]');d&&d.blur(),document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),setTimeout(()=>{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur()},10);const c=e||"çƒ­é—¨æ¨è";history.pushState({searchKeyword:c},"",`/#search?q=${encodeURIComponent(c)}`)}catch(e){t.error("æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{this.hideFullScreenLoading()}})},handleHistoryClick(e){this.keyword=e,this.isOpen=!1,this.performSearch(e,!1)},submitSearch(){return e(this,void 0,void 0,function*(){const e=this.keyword.trim();e&&document.dispatchEvent(new CustomEvent("add-history",{detail:e})),this.clearAutocomplete(),yield this.performSearch(e,!0)})},fetchAutocompleteSuggestions(t){return e(this,void 0,void 0,function*(){if(!t.trim())return this.autocompleteSuggestions=[],void(this.lastSearchKeyword="");const e=t.toLowerCase();if(this.suggestionCache.has(e))return this.autocompleteSuggestions=this.suggestionCache.get(e),void(this.lastSearchKeyword=t);if(this.lastSearchKeyword&&t.startsWith(this.lastSearchKeyword)&&this.autocompleteSuggestions.length>0){const e=this.autocompleteSuggestions.filter(e=>e.name.toLowerCase().includes(t.toLowerCase()));if(e.length>0)return this.autocompleteSuggestions=e,this.lastSearchKeyword=t,void this.fetchNewSuggestions(t,!1)}yield this.fetchNewSuggestions(t,!0)})},fetchNewSuggestions(t){return e(this,arguments,void 0,function*(e,t=!0){try{const i=yield fetch(`/api.php/search/suggest?keyword=${encodeURIComponent(e)}&limit=8`),o=yield i.json();if(200===o.code&&Array.isArray(o.data)){if(this.autocompleteSuggestions=o.data,this.lastSearchKeyword=e,this.suggestionCache.size>=50){const e=this.suggestionCache.keys().next().value;this.suggestionCache.delete(e)}this.suggestionCache.set(e.toLowerCase(),o.data)}else t&&(this.autocompleteSuggestions=[],this.lastSearchKeyword=e)}catch(e){t&&(this.autocompleteSuggestions=[])}})},handleInputChange(){this.selectedIndex=-1,this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.fetchAutocompleteSuggestions(this.keyword)},300),this.isOpen=!0},selectSuggestion(e){document.dispatchEvent(new CustomEvent("add-history",{detail:e.name})),window.location.href=`/vd/${e.id}.html`},clearAutocomplete(){this.autocompleteSuggestions=[],this.lastSearchKeyword="",this.selectedIndex=-1,this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null)},handleArrowUp(e){0!==this.autocompleteSuggestions.length&&(e.preventDefault(),-1===this.selectedIndex?this.selectedIndex=this.autocompleteSuggestions.length-1:this.selectedIndex>0?this.selectedIndex--:this.selectedIndex=this.autocompleteSuggestions.length-1)},handleArrowDown(e){0!==this.autocompleteSuggestions.length&&(e.preventDefault(),-1===this.selectedIndex?this.selectedIndex=0:this.selectedIndex<this.autocompleteSuggestions.length-1?this.selectedIndex++:this.selectedIndex=0)},handleEnterKey(){if(this.selectedIndex>=0&&this.selectedIndex<this.autocompleteSuggestions.length){const e=this.autocompleteSuggestions[this.selectedIndex];this.selectSuggestion(e)}else this.submitSearch()},handleEscape(){this.selectedIndex=-1,this.isOpen=!1}}};const h={config:{key:"play_history",maxItems:6},addAndUpdateHistory(e,t){const i=localStorage.getItem(this.config.key),o=i?JSON.parse(i):{};if(!o[e]&&Object.keys(o).length>=this.config.maxItems){delete o[Object.entries(o).sort((e,t)=>e[1].createTime-t[1].createTime)[0][0]]}o[e]=t,localStorage.setItem(this.config.key,JSON.stringify(o))}};function u(e){try{return new Function(`return ${e}`)()}catch(e){throw new Error("éªŒè¯å¤±è´¥")}}class p{constructor(){this.player=null,this.playData=null,this.isCreating=!1,this.loadingHidden=!1,this.videoEventListeners=[]}buildLoadingContext(e){const t=(e.sourceName||e.vodFrom||"").trim();let i=(e.vodPart||"").trim();return!i&&Number.isFinite(e.vodNid)&&e.vodNid>0&&(i=`ç¬¬${e.vodNid}é›†`),t&&i?`${t} Â· ${i}`:t||i||""}createPlayer(t,i,o){return e(this,void 0,void 0,function*(){if(!this.isCreating){this.isCreating=!0;try{this.destroyPlayer(),this.loadingHidden=!1,this.createLoadingScreen(),c.setMode("loading");const n=this.buildLoadingContext(i);c.setContext(n),c.show("æ­£åœ¨åˆå§‹åŒ–æ’­æ”¾å™¨..."),yield new Promise(e=>setTimeout(e,50)),this.playData=Object.assign({},i);if("1"===i.decodeStatus||"2"===i.decodeStatus)try{c.show(`æ­£åœ¨è§£æ${i.vodFrom}åœ°å€...`),t=yield function(t,i){return e(this,void 0,void 0,function*(){const e="/api.php/decode/url/",o=new URLSearchParams({url:t,vodFrom:i});let n=null;for(let s=1;s<=2;s++)try{const n=new AbortController,s=setTimeout(()=>n.abort(),5e3);try{const r=yield fetch(`${e}?${o.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"},signal:n.signal});if(clearTimeout(s),!r.ok)throw new Error(`è§£ç è¯·æ±‚å¤±è´¥: ${r.status} ${r.statusText}`);const a=yield r.json();if(2===a.code&&a.challenge){const o=u(a.challenge),n=new AbortController,s=setTimeout(()=>n.abort(),5e3),r=new URLSearchParams({url:t,vodFrom:i,token:o}),l=yield fetch(`${e}?${r.toString()}`,{method:"GET",headers:{"Content-Type":"application/json"},signal:n.signal});if(clearTimeout(s),!l.ok)throw new Error(`éªŒè¯è¯·æ±‚å¤±è´¥: ${l.status} ${l.statusText}`);const d=yield l.json();if(1!==d.code)throw new Error(`è§£ç å¤±è´¥: ${d.msg||"Unknown error"}`);if(!d.data||""===d.data.trim())throw new Error("è§£ç è¿”å›çš„URLä¸ºç©º");return d.data}if(1===a.code){if(!a.data||""===a.data.trim())throw new Error("è§£ç è¿”å›çš„URLä¸ºç©º");return a.data}throw new Error(`è§£ç å¤±è´¥: ${a.msg||"Unknown error"}`)}catch(e){throw clearTimeout(s),e}}catch(e){n=e,s<2&&(yield new Promise(e=>setTimeout(e,1e3)))}throw n||new Error("è§£ç å¤±è´¥ï¼šæ‰€æœ‰é‡è¯•æ¬¡æ•°å·²ç”¨å®Œ")})}(t,i.vodFrom),c.show(`${i.vodFrom}åœ°å€è§£ææˆåŠŸ`),yield new Promise(e=>setTimeout(e,800))}catch(e){return this.destroyPlayer(),this.showErrorMessage(i.vodFrom+"åœ°å€è§£æå¤±è´¥ï¼Œè¯·åˆ‡æ¢å…¶ä»–æ’­æ”¾æº"),void(this.isCreating=!1)}const s=e=>{const t=e.toLowerCase();return t.includes(".m3u8")||t.includes("m3u8")?"m3u8":null},r=s(t),a=Object.assign(Object.assign({container:"#artplayer-container",url:t},r&&{type:r}),{volume:.7,isLive:!1,muted:!1,autoplay:!0,pip:!0,autoSize:!1,autoMini:!1,screenshot:!1,setting:!0,loop:!1,flip:!1,playbackRate:!0,aspectRatio:!1,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!1,miniProgressBar:!1,mutex:!0,playsInline:!0,autoPlayback:!1,airplay:!0,theme:"#FFD700",lang:"zh-cn",hotkey:!1,fastForward:!0,autoOrientation:!0,lock:!0,customType:{m3u8:(e,t)=>{const o="undefined"!=typeof window&&"function"==typeof window.webkitConvertPointFromNodeToPage,n=navigator.userAgent.includes("Quark");if(o||n){c.show("WebKitåŸç”Ÿæ’­æ”¾å™¨å‡†å¤‡ä¸­..."),e.src=t,e.load(),this.addVideoEventListener(e,"loadstart",()=>{c.show("å¼€å§‹åŠ è½½è§†é¢‘èµ„æº...")});let i=-1;this.addVideoEventListener(e,"progress",()=>{if(e.buffered.length>0){const t=e.buffered.end(0),o=e.duration||0;if(o>0){const e=Math.round(t/o*100);e!==i&&e%5==0&&(c.show(`æ­£åœ¨ç¼“å†²è§†é¢‘æ•°æ® ${e}%`),i=e)}else c.show("æ­£åœ¨ä¸‹è½½è§†é¢‘æ•°æ®...")}}),this.addVideoEventListener(e,"loadedmetadata",()=>{c.show("è§†é¢‘ä¿¡æ¯è·å–å®Œæˆ")}),this.addVideoEventListener(e,"loadeddata",()=>{c.show("è§†é¢‘æ•°æ®åŠ è½½å®Œæˆ")}),this.addVideoEventListener(e,"canplay",()=>{c.show("è§†é¢‘å‡†å¤‡å°±ç»ª")})}else{if(!Hls)return;e.hls&&e.hls.destroy();const o=new Hls({debug:!1,enableWorker:!0,lowLatencyMode:!0,maxBufferLength:1200,backBufferLength:60,maxBufferSize:2e8});c.show("HLSè§£ç å™¨åˆ›å»ºæˆåŠŸ"),o.loadSource(t),o.attachMedia(e),e.hls=o,c.show("æ­£åœ¨åŠ è½½è§†é¢‘æµ..."),o.on(Hls.Events.MANIFEST_LOADING,()=>{c.show("æ­£åœ¨è·å–è§†é¢‘åˆ—è¡¨...")}),o.on(Hls.Events.MANIFEST_LOADED,()=>{c.show("è§†é¢‘åˆ—è¡¨åŠ è½½å®Œæˆ")}),o.on(Hls.Events.LEVEL_LOADED,()=>{c.show("æ­£åœ¨åŠ è½½è§†é¢‘ç‰‡æ®µ...")}),o.on(Hls.Events.ERROR,(e,t)=>{if(t.fatal)switch(t.type){case Hls.ErrorTypes.NETWORK_ERROR:c.show("ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œæ­£åœ¨é‡è¯•..."),o.startLoad(),this.showErrorMessage(i.vodFrom+"ç½‘ç»œé”™è¯¯ï¼Œè¯·åˆ‡æ¢å…¶ä»–æ’­æ”¾æº");break;case Hls.ErrorTypes.MEDIA_ERROR:c.show("å½“å‰æµè§ˆå™¨ä¸æ”¯æŒæ­¤è§†é¢‘æ ¼å¼ï¼Œè¯·åˆ‡æ¢çº¿è·¯æˆ–æ›´æ¢æµè§ˆå™¨..."),o.destroy();break;default:c.show("æ’­æ”¾å™¨é‡åˆ°ä¸¥é‡é”™è¯¯"),o.destroy()}})}}},controls:[{position:"left",index:13,html:'<i class="art-icon flex"><svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" fill="currentColor"/></svg></i>',tooltip:"æ’­æ”¾ä¸‹ä¸€é›†",click:function(){var e;null===(e=window.playlistComponent)||void 0===e||e.handleNextEpisode()}}]});this.player=new Artplayer(a),o&&o>0&&this.player.on("ready",()=>{this.player&&(this.player.currentTime=o)}),this.bindEvents(),this.isCreating=!1}catch(e){throw this.isCreating=!1,e}}})}bindEvents(){this.player&&(this.player.on("ready",()=>{c.show("æ’­æ”¾å™¨åˆå§‹åŒ–å®Œæˆ")}),this.player.on("video:loadedmetadata",()=>{var e;const t=null===(e=this.player)||void 0===e?void 0:e.duration;if(t&&t>0){const e=Math.floor(t/60),i=Math.floor(t%60);c.show(`è§†é¢‘ä¿¡æ¯è½½å…¥æˆåŠŸ (æ—¶é•¿ ${e}:${i.toString().padStart(2,"0")})`)}else c.show("è§†é¢‘ä¿¡æ¯è½½å…¥æˆåŠŸ")}),this.player.on("video:canplay",()=>{this.hideLoadingScreen()}),this.player.on("play",()=>{this.updatePlayProgress()}),this.player.on("pause",()=>{}),this.player.on("error",e=>{}),this.player.on("video:timeupdate",()=>{this.updatePlayProgress()}))}createLoadingScreen(){const e=document.querySelector(".player-box-main");e&&c.createLoadingScreen(e)}hideLoadingScreen(){this.loadingHidden||(this.loadingHidden=!0,c.hideLoadingScreen())}updatePlayProgress(){var e,t;if(!this.player)return;const i=this.player.currentTime;if(Math.floor(i)%5==0){if(!this.playData)return;const i={vodId:this.playData.vodId,currentTime:this.player.currentTime,duration:this.player.duration,createTime:Date.now(),vodName:this.playData.vodName,vodNid:this.playData.vodNid,vodSid:this.playData.vodSid,vodPart:this.playData.vodPart,playUrl:window.location.pathname+window.location.hash};let o;if(window.EXTERNAL_SEARCH_PARAMS&&(!(null===(e=window.PAGE_INFO)||void 0===e?void 0:e.vodId)||"0"==(null===(t=window.PAGE_INFO)||void 0===t?void 0:t.vodId))){o=`external_${window.EXTERNAL_SEARCH_PARAMS.name}_${window.EXTERNAL_SEARCH_PARAMS.year||"unknown"}`}else o=this.playData.vodId.toString();h.addAndUpdateHistory(o,i)}}showErrorMessage(e){var i;const o=document.querySelector("#professional-loading-overlay");o&&o.remove();const n=document.querySelector("#artplayer-container");if(n){const o=document.createElement("div");o.className="flex flex-col justify-center items-center h-full bg-black text-white text-base text-center p-5";const s="dyttm3u8"===(null===(i=this.playData)||void 0===i?void 0:i.vodFrom)?'<div class="mb-5 text-red-500">å½“å‰çº¿è·¯æš‚æ—¶ä¸æ”¯æŒå›½å¤–ç½‘ç»œ å¯å°è¯•åˆ‡æ¢ç½‘ç»œ</div>':"";o.innerHTML=`\n        <svg class="mb-5" width="60" height="60" viewBox="0 0 24 24" fill="none">\n          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="#FFD700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n          <line x1="12" y1="9" x2="12" y2="13" stroke="#FFD700" stroke-width="2" stroke-linecap="round"/>\n          <line x1="12" y1="17" x2="12.01" y2="17" stroke="#FFD700" stroke-width="2" stroke-linecap="round"/>\n        </svg>\n        <div class="text-lg mb-2.5 font-bold">æ’­æ”¾å¤±è´¥</div>\n        <div class="text-gray-400 mb-5">${e}</div>\n        ${s}\n        <button id="switch-source-btn" class="px-5 py-2.5 bg-yellow-400 text-black border-none rounded cursor-pointer text-sm font-bold transition-opacity hover:opacity-80">\n          åˆ‡æ¢æ’­æ”¾æº\n        </button>\n      `,n.innerHTML="",n.appendChild(o);const r=document.getElementById("switch-source-btn");r&&r.addEventListener("click",()=>{window.playlistComponent&&void 0!==window.playlistComponent.showSourceTab?window.playlistComponent.showSourceTab=!0:t.error("æ’­æ”¾æºåˆ‡æ¢åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨")})}}addVideoEventListener(e,t,i){e.addEventListener(t,i),this.videoEventListeners.push({element:e,event:t,handler:i})}clearVideoEventListeners(){this.videoEventListeners.forEach(({element:e,event:t,handler:i})=>{e.removeEventListener(t,i)}),this.videoEventListeners=[]}destroyPlayer(){if(this.clearVideoEventListeners(),this.player)try{const e=this.player.video;e&&e.hls&&(e.hls.destroy(),e.hls=null),this.player.destroy(),this.player=null}catch(e){}}}var m,y,g,f;let v=window.playlistComponent,w=null;function S(){return!v&&window.playlistComponent&&(v=window.playlistComponent),v||null}if("play"==(null===(m=window.PAGE_INFO)||void 0===m?void 0:m.currentPage)){if("0"!==(null===(y=window.PAGE_INFO)||void 0===y?void 0:y.vodId)){const C=`/ajax/hits?mid=1&id=${null===(g=window.PAGE_INFO)||void 0===g?void 0:g.vodId}&type=update`;i.get(C)}function I(e=!1,t=0){var i,o;const n=S();if(!n)return;const s=n.currentSource,r=null==s?void 0:s.urls.find(e=>e.nid===n.currentEpisodeNid);if(!r)return;const a=(null==s?void 0:s.show)||(null==s?void 0:s.from)||r.vodFrom||"",l={url:r.url,vodNid:r.nid,vodSid:r.sid,vodPart:r.part,vodId:parseInt((null===(i=window.PAGE_INFO)||void 0===i?void 0:i.vodId)||"0",10),vodName:(null===(o=window.PAGE_INFO)||void 0===o?void 0:o.vodName)||"",vodFrom:r.vodFrom,sourceName:a,decodeStatus:(null==s?void 0:s.decodeStatus)||"0"};let d=0;d=t||(e&&w&&w.player?w.player.currentTime:0),w||(w=new p),w.createPlayer(l.url,l,d)}document.addEventListener("start-play",e=>{const t=e.detail||{};I(!1,"number"==typeof(null==t?void 0:t.continueTime)?t.continueTime:void 0)}),document.addEventListener("source-selected",e=>{const{currentEpisodeNid:t}=e.detail,i=S();if(!i)return;const o=i.currentSource;o.urls.some(e=>e.nid===t)?I(!0):(i.setCurrentEpisodeNid(o.urls.length),I(!1))}),document.addEventListener("keydown",e=>{e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||(null==w?void 0:w.player)&&("f"!==e.key&&"F"!==e.key||(w.player.fullscreen=!w.player.fullscreen),"ArrowLeft"===e.key&&(w.player.currentTime-=10),"ArrowRight"===e.key&&(w.player.currentTime+=10),"ArrowUp"===e.key&&(w.player.volume+=.1),"ArrowDown"===e.key&&(w.player.volume-=.1)," "===e.key&&w.player.toggle())})}"detail"==(null===(f=window.PAGE_INFO)||void 0===f?void 0:f.currentPage)&&document.addEventListener("start-play",e=>{var t;const{sid:i,nid:o}=e.detail;window.location.href=`/vb/${null===(t=window.PAGE_INFO)||void 0===t?void 0:t.vodId}.html#sid=${i}&nid=${o}`}),window.rankTabs=function(){return{activeTab:"week",init(){this.activeTab="week",this.initScrollDrag()},switchTab(e){this.activeTab=e},initScrollDrag(){["rank-scroll-x-week","rank-scroll-x-month","rank-scroll-x-total"].forEach(e=>this.initNativeDrag(e))},initNativeDrag(e){const t=document.getElementById(e);if(!t)return;let i,o,n=!1,s=!1;const r=e=>{n&&(n=!1,t.classList.remove("cursor-grabbing"),t.querySelectorAll("a").forEach(e=>{e.style.pointerEvents=""}),s&&e.target instanceof HTMLElement&&e.target.closest("a")&&(e.preventDefault(),e.stopPropagation()))};t.addEventListener("mousedown",e=>{n=!0,s=!1,t.classList.add("cursor-grabbing"),i=e.pageX-t.offsetLeft,o=t.scrollLeft}),t.addEventListener("mousemove",e=>{if(!n)return;const r=e.pageX-t.offsetLeft-i;Math.abs(r)>5&&(s=!0,t.querySelectorAll("a").forEach(e=>{e.style.pointerEvents="none"})),e.preventDefault(),t.scrollLeft=o-r}),t.addEventListener("mouseup",r),t.addEventListener("mouseleave",r)}}},window.vodFilter=function(t,i){return{typeName:t,classOptions:i.classOptions||[],areaOptions:i.areaOptions||[],yearOptions:i.yearOptions||[],filters:{class:"",area:"",year:""},sort:"hits",page:1,limit:24,list:[],total:0,pageCount:0,loading:!1,error:"",init(){return e(this,void 0,void 0,function*(){const e=new URLSearchParams(window.location.search);this.filters.class=e.get("class")||"",this.filters.area=e.get("area")||"",this.filters.year=e.get("year")||"",this.sort=e.get("sort")||"hits";const t=window.location.pathname.match(/\/vodshow\/(\d+)(?:\/(\d+))?\.html/);t&&t[2]&&(this.page=parseInt(t[2])),yield this.loadData()})},setFilter(t,i){return e(this,void 0,void 0,function*(){this.filters[t]=i,this.page=1,this.updateUrl(),yield this.loadData()})},setSort(t){return e(this,void 0,void 0,function*(){this.sort=t,this.page=1,this.updateUrl(),yield this.loadData()})},setPage(t){return e(this,void 0,void 0,function*(){this.page=t,this.updateUrl(),yield this.loadData(),window.scrollTo({top:0,behavior:"smooth"})})},loadData(){return e(this,void 0,void 0,function*(){this.loading=!0,this.error="";try{const e=new URLSearchParams;e.append("type_name",this.typeName),this.filters.class&&e.append("class",this.filters.class),this.filters.area&&e.append("area",this.filters.area),this.filters.year&&e.append("year",this.filters.year),e.append("sort",this.sort),e.append("page",this.page.toString()),e.append("limit",this.limit.toString());const t=yield fetch(`/api.php/filter/vod?${e.toString()}`),i=yield t.json();200===i.code?(this.list=i.data||[],this.total=i.total||0,this.pageCount=i.pageCount||0):this.error=i.msg||"åŠ è½½å¤±è´¥"}catch(e){this.error="ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•"}finally{this.loading=!1}})},updateUrl(){const e=new URLSearchParams;this.filters.class&&e.set("class",this.filters.class),this.filters.area&&e.set("area",this.filters.area),this.filters.year&&e.set("year",this.filters.year),"hits"!==this.sort&&e.set("sort",this.sort);const t=window.location.pathname.match(/\/vodshow\/(\d+)/),i=`${`/vodshow/${t?t[1]:"1"}/${this.page}.html`}${e.toString()?"?"+e.toString():""}`;window.history.pushState({},"",i)},get paginationPages(){const e=[],t=this.pageCount,i=this.page;if(t<=7)for(let i=1;i<=t;i++)e.push(i);else{e.push(1),i>4&&e.push("...");const o=Math.max(2,i-2),n=Math.min(t-1,i+2);for(let t=o;t<=n;t++)e.push(t);i<t-3&&e.push("..."),e.push(t)}return e}}};let b=null,E=null;function L(){const e=document.querySelector('link[href*="/template/"]');if(e){const t=e.href.match(/\/template\/([^\/]+)\//);if(t)return`/template/${t[1]}/`}return null}function x(){b||("loading"===document.readyState?document.addEventListener("DOMContentLoaded",k):k())}function k(){window.IntersectionObserver?(b=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target,i=t.getAttribute("data-original");i&&A(t,P(i))}})},{rootMargin:"400px",threshold:0}),T(),window.MutationObserver&&(E=new MutationObserver(e=>{let t=!1;e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const i=e;i.matches&&i.matches("img.lazy")&&(t=!0),i.querySelectorAll&&i.querySelectorAll("img.lazy").length>0&&(t=!0)}})}),t&&setTimeout(T,100)}),E.observe(document.body,{childList:!0,subtree:!0}))):function(){const e=()=>{document.querySelectorAll("img.lazy").forEach(e=>{const t=e.getAttribute("data-original");t&&!e.classList.contains("loaded")&&A(e,P(t))})};e(),setInterval(e,3e3)}()}function T(){document.querySelectorAll("img.lazy").forEach(e=>{!b||e.classList.contains("loaded")||e.classList.contains("loading")||b.observe(e)})}function A(e,t){if(e.classList.contains("loaded")||e.classList.contains("loading"))return;e.classList.add("loading");const i=new Image;i.onload=function(){if(4===i.naturalWidth){const e=L();e&&(t=e+"asset/images/load.png")}e.src=t,e.classList.remove("lazy","loading"),e.classList.add("loaded"),e.style.opacity="0",e.style.transition="opacity 0.3s ease-in-out",requestAnimationFrame(()=>{e.style.opacity="1"}),b&&b.unobserve(e)},i.onerror=function(){if(e.classList.remove("loading"),e.classList.add("error"),e.hasAttribute("data-retry")){const t=L();t?(e.src=t+"asset/images/load.png",e.classList.remove("lazy"),e.classList.add("loaded")):(e.classList.remove("lazy"),e.classList.add("error")),b&&b.unobserve(e)}else e.setAttribute("data-retry","1"),setTimeout(()=>{A(e,t)},1e3)},i.src=t}function P(e){return e.includes("doubanio")?e:e?e.startsWith("https://gimg0.baidu.com/gimg/")?e:"https://gimg0.baidu.com/gimg/app=2001&n=0&g=0n&fmt=jpeg&src="+encodeURIComponent(e):""}x(),window.ToastModule=t,document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("click",e=>{const t=e.target;t&&("request-btn"===t.id||t.closest("#request-btn"))&&(e.preventDefault(),e.stopPropagation(),new URLSearchParams(window.location.search),r("/gbook/report.html?type=request")),t&&("feedback-btn"===t.id||t.closest("#feedback-btn"))&&(e.preventDefault(),e.stopPropagation(),r("/gbook/report.html?type=feedback"))})}),document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("keydown",function(e){var t;"Escape"===e.key&&document.getElementById("popup-content")&&(null===(t=document.getElementById("popup-content"))||void 0===t||t.remove(),l())}),document.body.addEventListener("change",function(e){const t=e.target;if(t&&"error_reason"===t.name){const e=document.getElementById("other-reason-input"),i=document.querySelector(".email-option-container"),o=document.querySelector(".submit-container"),n=document.getElementById("buffering-tip"),s=document.getElementById("loading-tip");if("æ’­æ”¾å¡é¡¿"===t.value){if(i&&i.classList.add("hidden"),n&&n.classList.remove("hidden"),s&&s.classList.add("hidden"),o&&o.classList.add("hidden"),e){e.classList.add("hidden");const t=e.querySelector("textarea");t&&(t.value="")}}else if("åŠ è½½ä¸å‡ºè§†é¢‘"===t.value){if(i&&i.classList.add("hidden"),n&&n.classList.add("hidden"),s&&s.classList.remove("hidden"),o&&o.classList.remove("hidden"),e){e.classList.add("hidden");const t=e.querySelector("textarea");t&&(t.value="")}}else if("å…¶ä»–"===t.value)i&&i.classList.remove("hidden"),n&&n.classList.add("hidden"),s&&s.classList.add("hidden"),o&&o.classList.remove("hidden"),e&&(e.classList.remove("hidden"),setTimeout(()=>{const t=e.querySelector("textarea");t&&t.focus()},100));else if(i&&i.classList.add("hidden"),n&&n.classList.add("hidden"),s&&s.classList.add("hidden"),o&&o.classList.remove("hidden"),e){e.classList.add("hidden");const t=e.querySelector("textarea");t&&(t.value="")}}if(t&&"want_reply"===t.name){const e=document.getElementById("email-input");if(e)if(t.checked)e.classList.remove("hidden"),setTimeout(()=>{const t=e.querySelector("input");t&&t.focus()},100);else{e.classList.add("hidden");const t=e.querySelector("input");t&&(t.value="")}}}),document.body.addEventListener("click",function(o){return e(this,void 0,void 0,function*(){var e,n,s;const r=o.target;if(r&&(r.closest("#close-popup")||r.classList.contains("shortcuts-mobile-overlay")))return null===(e=document.getElementById("popup-content"))||void 0===e||e.remove(),void l();if(r&&"gbook_submit"===r.id){o.preventDefault();const e=document.querySelector("input[name='gbook_content']"),r=document.querySelector("textarea[name='gbook_content']"),a=null===(s=null===(n=document.querySelector(".popup-title"))||void 0===n?void 0:n.textContent)||void 0===s?void 0:s.trim();if("æˆ‘è¦æŠ¥é”™"===a){if(!e||""===e.value.trim())return t.warning("å½±ç‰‡ä¿¡æ¯ç¼ºå¤±ï¼Œè¯·é‡æ–°æ‰“å¼€æŠ¥é”™çª—å£"),!1}else if(!r||""===r.value.trim())return t.warning("è¯·å¡«å†™å†…å®¹"),r&&r.focus(),!1;const d=document.querySelectorAll("input[name='error_reason']");let c="";if(d.length>0){if(d.forEach(e=>{e.checked&&(c=e.value)}),!c)return t.warning("è¯·é€‰æ‹©é—®é¢˜ç±»å‹"),!1;if("å…¶ä»–"===c){const e=document.querySelector("textarea[name='other_reason_detail']");if(!e||""===e.value.trim())return t.warning("è¯·æè¿°æ‚¨é‡åˆ°çš„å…¶ä»–é—®é¢˜"),e&&e.focus(),!1}}const h=document.querySelector("input[name='want_reply']");if(h&&h.checked){const e=document.querySelector("input[name='reply_email']");if(!e||""===e.value.trim())return t.warning("è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€"),e&&e.focus(),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value.trim()))return t.warning("è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼"),e&&e.focus(),!1}const u=document.querySelector("input[name='verify']");if(u&&""===u.value.trim())return t.warning("è¯·è¾“å…¥éªŒè¯ç "),u.focus(),!1;const p=document.querySelector(".gbook_form"),m=new FormData(p),y=new URLSearchParams,g="æˆ‘è¦æŠ¥é”™"===a?(null==e?void 0:e.value.trim())||"":(null==r?void 0:r.value.trim())||"";let f=a?`ã€${a}ã€‘${g}`:g;if(c&&(f+=`\n\né—®é¢˜ç±»å‹ï¼š${c}`,"å…¶ä»–"===c)){const e=document.querySelector("textarea[name='other_reason_detail']");e&&e.value.trim()&&(f+=`\né—®é¢˜è¯¦æƒ…ï¼š${e.value.trim()}`)}if(h&&h.checked){const e=document.querySelector("input[name='reply_email']");e&&e.value.trim()&&(f+=`\n\nè”ç³»é‚®ç®±ï¼š${e.value.trim()}`)}for(const[e,t]of m)"gbook_content"===e?y.append(e,f):"error_reason"!==e&&"other_reason_detail"!==e&&"want_reply"!==e&&"reply_email"!==e&&y.append(e,t);const v="/gbook/saveData";i.submitForm(v,y,function(e){if(1==e.code)t.success(e.msg||"æäº¤æˆåŠŸ"),setTimeout(()=>{var e;null===(e=document.getElementById("popup-content"))||void 0===e||e.remove(),l()},1e3);else if(t.error(e.msg||"æäº¤å¤±è´¥"),1002===e.code){const e=document.getElementById("report-verify");e&&(e.src=e.src.split("?")[0]+"?"+Date.now());const t=document.querySelector("input[name='verify']");t&&(t.value="",t.focus())}},function(e){t.error("ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•")})}if(r&&"report-verify"===r.id){const e=document.getElementById("report-verify");e&&(e.src=e.src.split("?")[0]+"?"+Date.now())}})})}),x()}();
//# sourceMappingURL=v49464.js.map
